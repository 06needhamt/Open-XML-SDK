steps:
    
  - task: VSBuild@1
    displayName: 'Build SDK'
    inputs:
      solution: '$(SdkSolution)'
      msbuildArgs: '/t:restore;build /p:ProjectLoadStyle=$(ProjectLoadStyle)'
      platform: '$(BuildPlatform)'
      configuration: '$(BuildConfiguration)'

  - task: VSBuild@1
    displayName: 'Pack SDK'
    inputs:
      msbuildArgs: '/t:pack /p:ProjectLoadStyle=$(ProjectLoadStyle) /p:PackageOutputPath=$(Build.ArtifactStagingDirectory)/unsigned'
      platform: '$(BuildPlatform)'
      configuration: '$(BuildConfiguration)'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Unsigned'
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)/unsigned'
      artifactName: 'unsigned'

  - task: CopyFiles@2
    inputs:
      SourceFolder: 'bin\$(BuildConfiguration)'
      Contents: '*.Tests/**/*'
      TargetFolder: '$(Build.ArtifactStagingDirectory)/tests'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Tests'
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)/tests'
      artifactName: 'tests'
